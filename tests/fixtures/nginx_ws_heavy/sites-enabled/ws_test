map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

upstream ws_backend {
    server 127.0.0.1:8080;
}

server {
    listen 80;
    server_name ws.example.com;

    # Valid WS Config
    location /ws-app/ {
        proxy_pass http://ws_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }

    # Invalid WS Config (NGX-WSS-001/002/003)
    location /ws-broken/ {
        proxy_pass http://localhost:3000;
        # Missing headers and http_version
    }
    
    # Invalid WS Config (NGX-WSS-005)
    location /ws-timeout/ {
        proxy_pass http://localhost:4000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_read_timeout 30s; # Too low
    }
}
