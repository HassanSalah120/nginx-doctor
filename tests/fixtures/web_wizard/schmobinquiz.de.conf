# Fixture: schmobinquiz.de with /wcas and /imposter existing locations

server {
    listen 80;
    listen [::]:80;
    server_name schmobinquiz.de www.schmobinquiz.de;
    
    root /var/www/schmobinquiz.de/public;
    index index.php index.html;
    
    # Main site
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    # Main PHP handler
    location ~ \.php$ {
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    
    # --- nginx-doctor project: /wcas (laravel) ---
    location /wcas {
        alias /var/www/wcas/public;
        index index.php;
        try_files $uri $uri/ @wcas_laravel;
    }
    
    location @wcas_laravel {
        rewrite ^/wcas/(.*)$ /wcas/index.php?/$1 last;
    }
    
    location ~ ^/wcas/index\.php(/|$) {
        alias /var/www/wcas/public;
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
        fastcgi_split_path_info ^(/wcas)(/.*)$;
        fastcgi_param SCRIPT_FILENAME /var/www/wcas/public/index.php;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        include fastcgi_params;
        fastcgi_param REQUEST_URI $request_uri;
    }
    
    location ~ ^/wcas/.*\.php$ {
        deny all;
        return 404;
    }
    # --- end nginx-doctor project: /wcas ---
    
    # --- nginx-doctor project: /imposter (laravel) ---
    location /imposter {
        alias /var/www/imposter/public;
        index index.php;
        try_files $uri $uri/ @imposter_laravel;
    }
    
    location @imposter_laravel {
        rewrite ^/imposter/(.*)$ /imposter/index.php?/$1 last;
    }
    
    location ~ ^/imposter/index\.php(/|$) {
        alias /var/www/imposter/public;
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
        fastcgi_split_path_info ^(/imposter)(/.*)$;
        fastcgi_param SCRIPT_FILENAME /var/www/imposter/public/index.php;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        include fastcgi_params;
        fastcgi_param REQUEST_URI $request_uri;
    }
    
    location ~ ^/imposter/.*\.php$ {
        deny all;
        return 404;
    }
    # --- end nginx-doctor project: /imposter ---
    
    # Static assets caching
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
