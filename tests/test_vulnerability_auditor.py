"""Tests for VulnerabilityAuditor."""

from nginx_doctor.analyzer.vulnerability_auditor import VulnerabilityAuditor
from nginx_doctor.model.evidence import Severity
from nginx_doctor.model.server import ServerModel, VulnerabilityModel


def test_vulnerability_auditor_cve_finding():
    model = ServerModel(hostname="test")
    model.vulnerability = VulnerabilityModel(
        provider="apt",
        cve_ids=["CVE-2025-1000", "CVE-2025-1001"],
        advisory_ids=["USN-7000-1"],
        affected_packages=["openssl"],
    )

    findings = VulnerabilityAuditor(model).audit()
    ids = {f.id for f in findings}
    assert "VULN-1" in ids


def test_vulnerability_auditor_large_surface_info():
    model = ServerModel(hostname="test")
    model.vulnerability = VulnerabilityModel(
        provider="apt",
        cve_ids=[],
        advisory_ids=[],
        affected_packages=[f"pkg{i}" for i in range(60)],
    )

    findings = VulnerabilityAuditor(model).audit()
    vuln3 = next(f for f in findings if f.id == "VULN-3")
    assert vuln3.severity == Severity.INFO
